get_inform<-get_inform[1,]
#import an issueNo
url2<-paste("http://data.ekape.or.kr/openapi-data/service/user/grade/confirm/issueNo?animalNo=",Cattle_No,"&ServiceKey=",API_key,sep="")
xmlfile2<-xmlParse(url2)
xmltop2<-xmlRoot(xmlfile2)
get_issueNo<-xmlToDataFrame(getNodeSet(xmlfile2,"//item"),stringsAsFactors=FALSE)
get_issueNo<-get_issueNo[1,]
Issue_No<-gsub(" ","",as.character(get_issueNo$issueNo)) #OR Issue_No<-stringr::str_trim(as.character(get_issueNo$issueNo))
#import the carcass characteristics (by using the IssueNo)
url3<-paste("http://data.ekape.or.kr/openapi-data/service/user/grade/confirm/cattle?issueNo=",Issue_No,"&ServiceKey=",API_key,sep="")
xmlfile3<-xmlParse(url3)
xmltop3<-xmlRoot(xmlfile3)
get_hanwoo<-xmlToDataFrame(getNodeSet(xmlfile3,"//item"),stringsAsFactors=FALSE)
get_hanwoo<-get_hanwoo[1,]
if(is.null(get_inform[1,1]) == FALSE){
results[nb,1]<-get_inform$farmNm
results[nb,2]<-get_inform$farmAddr
results[nb,3]<-get_inform$sexNm
results[nb,4]<-get_inform$birthYmd
}
if(is.null(get_issueNo[1,1]) == FALSE){
results[nb,7]<-get_issueNo$animalNo
}
if(is.null(get_hanwoo[1,1]) == FALSE | get_hanwoo$qgrade != "D"){
results[nb,5]<-get_inform$butcheryYmd
results[nb,6]<-(as.Date(get_inform$butcheryYmd)-as.Date(get_inform$birthYmd))/(365/12)
results[nb,8]<-get_hanwoo$gradeNm
results[nb,9]<-get_hanwoo$qgrade
results[nb,10]<-get_hanwoo$wgrade
results[nb,11]<-as.numeric(get_hanwoo$weight)
results[nb,12]<-as.numeric(get_hanwoo$windex)
}
}
#dataframe
hanwoo<-read.csv("jdfarm_carcass.txt",colClasses=c("character"),col.names="Cattle_No") #read the dataframe
n<-nrow(hanwoo) #number of animals
results<-data.frame(farmerNm=rep(NA,n),farmAddr=rep(NA,n),SexNm=rep(NA,n),birthYMD=rep(NA,n),butcheryYmd=rep(NA,n),month=rep(NA,n), animalNo=rep(NA,n),gradeNm=rep(NA,n),qgrade=rep(NA,n),wgrade=rep(NA,n),weight=rep(NA,n),windex=rep(NA,n))
#API parsing
API_key<-"GET YOUR SERVICE KEY FROM data.go.kr"
API_key<-"1KTzXwIIp1Gn1weD3eRnsmkbcw8NbH6vtU4wRhJpZoLgP4efuf%2FH27OczlrUCFKKHRYxk4Rn9OXxJpTlNd%2BU%2Fw%3D%3D"
for(i in 0:(n-1)){
nb=i+1
Cattle_No<-hanwoo[nb,]
#import basic informations
url1<-paste("http://data.ekape.or.kr/openapi-data/service/user/mtrace/breeding/cattle?cattleNo=",Cattle_No,"&ServiceKey=",API_key,sep="")
xmlfile1<-xmlParse(url1)
xmltop1<-xmlRoot(xmlfile1)
get_inform<-xmlToDataFrame(getNodeSet(xmlfile1,"//item"),stringsAsFactors=FALSE)
get_inform<-get_inform[1,]
#import an issueNo
url2<-paste("http://data.ekape.or.kr/openapi-data/service/user/grade/confirm/issueNo?animalNo=",Cattle_No,"&ServiceKey=",API_key,sep="")
xmlfile2<-xmlParse(url2)
xmltop2<-xmlRoot(xmlfile2)
get_issueNo<-xmlToDataFrame(getNodeSet(xmlfile2,"//item"),stringsAsFactors=FALSE)
get_issueNo<-get_issueNo[1,]
Issue_No<-gsub(" ","",as.character(get_issueNo$issueNo)) #OR Issue_No<-stringr::str_trim(as.character(get_issueNo$issueNo))
#import the carcass characteristics (by using the IssueNo)
url3<-paste("http://data.ekape.or.kr/openapi-data/service/user/grade/confirm/cattle?issueNo=",Issue_No,"&ServiceKey=",API_key,sep="")
xmlfile3<-xmlParse(url3)
xmltop3<-xmlRoot(xmlfile3)
get_hanwoo<-xmlToDataFrame(getNodeSet(xmlfile3,"//item"),stringsAsFactors=FALSE)
get_hanwoo<-get_hanwoo[1,]
if(is.null(get_inform[1,1]) == FALSE){
results[nb,1]<-get_inform$farmNm
results[nb,2]<-get_inform$farmAddr
results[nb,3]<-get_inform$sexNm
results[nb,4]<-get_inform$birthYmd
}
if(is.null(get_issueNo[1,1]) == FALSE){
results[nb,7]<-get_issueNo$animalNo
}
if(is.null(get_hanwoo[1,1]) == FALSE xor get_hanwoo$qgrade != "D"){
results[nb,5]<-get_inform$butcheryYmd
results[nb,6]<-(as.Date(get_inform$butcheryYmd)-as.Date(get_inform$birthYmd))/(365/12)
results[nb,8]<-get_hanwoo$gradeNm
results[nb,9]<-get_hanwoo$qgrade
results[nb,10]<-get_hanwoo$wgrade
results[nb,11]<-as.numeric(get_hanwoo$weight)
results[nb,12]<-as.numeric(get_hanwoo$windex)
}
}
hanwoo<-read.csv("jdfarm_carcass.txt",colClasses=c("character"),col.names="Cattle_No") #read the dataframe
n<-nrow(hanwoo) #number of animals
results<-data.frame(farmerNm=rep(NA,n),farmAddr=rep(NA,n),SexNm=rep(NA,n),birthYMD=rep(NA,n),butcheryYmd=rep(NA,n),month=rep(NA,n), animalNo=rep(NA,n),gradeNm=rep(NA,n),qgrade=rep(NA,n),wgrade=rep(NA,n),weight=rep(NA,n),windex=rep(NA,n))
#API parsing
API_key<-"GET YOUR SERVICE KEY FROM data.go.kr"
API_key<-"1KTzXwIIp1Gn1weD3eRnsmkbcw8NbH6vtU4wRhJpZoLgP4efuf%2FH27OczlrUCFKKHRYxk4Rn9OXxJpTlNd%2BU%2Fw%3D%3D"
for(i in 0:(n-1)){
nb=i+1
Cattle_No<-hanwoo[nb,]
#import basic informations
url1<-paste("http://data.ekape.or.kr/openapi-data/service/user/mtrace/breeding/cattle?cattleNo=",Cattle_No,"&ServiceKey=",API_key,sep="")
xmlfile1<-xmlParse(url1)
xmltop1<-xmlRoot(xmlfile1)
get_inform<-xmlToDataFrame(getNodeSet(xmlfile1,"//item"),stringsAsFactors=FALSE)
get_inform<-get_inform[1,]
#import an issueNo
url2<-paste("http://data.ekape.or.kr/openapi-data/service/user/grade/confirm/issueNo?animalNo=",Cattle_No,"&ServiceKey=",API_key,sep="")
xmlfile2<-xmlParse(url2)
xmltop2<-xmlRoot(xmlfile2)
get_issueNo<-xmlToDataFrame(getNodeSet(xmlfile2,"//item"),stringsAsFactors=FALSE)
get_issueNo<-get_issueNo[1,]
Issue_No<-gsub(" ","",as.character(get_issueNo$issueNo)) #OR Issue_No<-stringr::str_trim(as.character(get_issueNo$issueNo))
#import the carcass characteristics (by using the IssueNo)
url3<-paste("http://data.ekape.or.kr/openapi-data/service/user/grade/confirm/cattle?issueNo=",Issue_No,"&ServiceKey=",API_key,sep="")
xmlfile3<-xmlParse(url3)
xmltop3<-xmlRoot(xmlfile3)
get_hanwoo<-xmlToDataFrame(getNodeSet(xmlfile3,"//item"),stringsAsFactors=FALSE)
get_hanwoo<-get_hanwoo[1,]
if(is.null(get_inform[1,1]) == FALSE){
results[nb,1]<-get_inform$farmNm
results[nb,2]<-get_inform$farmAddr
results[nb,3]<-get_inform$sexNm
results[nb,4]<-get_inform$birthYmd
}
if(is.null(get_issueNo[1,1]) == FALSE){
results[nb,7]<-get_issueNo$animalNo
}
if(is.null(get_hanwoo[1,1]) == FALSE){
results[nb,5]<-get_inform$butcheryYmd
results[nb,6]<-(as.Date(get_inform$butcheryYmd)-as.Date(get_inform$birthYmd))/(365/12)
results[nb,8]<-get_hanwoo$gradeNm
results[nb,9]<-get_hanwoo$qgrade
}
if(get_hanwoo$qgrade != "D"){
results[nb,10]<-get_hanwoo$wgrade
results[nb,11]<-as.numeric(get_hanwoo$weight)
results[nb,12]<-as.numeric(get_hanwoo$windex)
}
}
#dataframe
hanwoo<-read.csv("jdfarm_carcass.txt",colClasses=c("character"),col.names="Cattle_No") #read the dataframe
n<-nrow(hanwoo) #number of animals
n
results<-filter(results, windex != "NA") #delete NA
write.csv(results, "results_jdfarm.txt", row.names=FALSE) #write csv
if(1==1 & 2==2){
print ="1"}
hanwoo2<-read.csv("results_jdfarm.txt")
hanwoo2
hanwoo2<-read.csv("results_jdfarm.txt")
hanwoo2<-read.csv("results_jdfarm.txt")
hanwoo2<-read.csv("results_jdfarm.txt")
read.csv("results_jdfarm.txt")
hanwoo2<-read.csv("results_jdfarm.txt")
hanwoo2
freq(hanwoo$육질등급, plot=FALSE) %>% round(digits=1) %>% kable()
View(hanwoo)
hanwoo<-readxl::read_excel("jdfarm_carcass.xlsx")
hanwoo2<-read.csv("results_jdfarm.txt")
View(hanwoo)
View(hanwoo2)
str(hanwoo2)
#R색깔 보기
library(RColorBrewer)
display.brewer.all()
get_requirement
mpg
mpg
iris
pmg
str(mpg)
clear
hwy
library(ggplot2)
mpg
ggplot(mpg,aes(cty,hwy))+geom_point()
t <- ggplot(mpg,aes(cty,hwy))+geom_point()
t+facet_grid(.~fl)
.~fl
t+facet_grid(year~.)
t+facet_wrap(~fl)
t+coord_polar()
t <- ggplot(mpg,aes(cty,hwy))
t+facet_grid(.~fl)
t+geom_bar(position="fill")
s <- ggplot(mpg, aes(fl,fill=drv))
s
s
s+geom_bar()
s+geom_bar(position="fill")
s+geom_bar(position="fill", width=3)
s+geom_bar(position="fill", width=1)
s+geom_bar(position="fill", width=0.1)
s+geom_bar(position="fill", width=0.5)
q()
options(warn=-1)
library(knitr)
library(ggplot2)
library(dplyr)
theme_set(theme_bw(base_family="AppleGothic"))
journal_list <- read.csv("journal_list.txt", header=TRUE)
journal_list <- read.csv("journal_list.txt", header=TRUE)
results <- read.csv("journal_result.txt", header=TRUE)
results <- results[,c(7,8,4,1,2,3,6)]
results
View(results)
#journal_scraping_all
library(rvest)
library(dplyr)
library(stringr)
#URL list
setwd("D:/GitHub/journal_scraping") #set working directory
list <- readxl::read_excel("journal_URL.xlsx") #set URL list
list <- filter(list, year==2017 & month==12)
#JAS=====================================================================================
list_JAS <- filter(list, journal == "journal of animal science") #filtering the journal
#data.frame
JAS_result<-list_JAS
JAS_result<-cbind(JAS_result, subject=NA)
JAS_result<-cbind(JAS_result, first_author=NA)
n<-nrow(list_JAS)
for(i in 0:(n-1)){
nb=i+1
url <- list_JAS$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(xpath="//div/h1/text()") %>% html_text()
#first_author
first_author<-html %>% html_nodes(".contributor-list") %>% html_children() %>% html_text()
first_author<-gsub(" and ","",first_author)
first_author<-gsub("*","",first_author, fixed=TRUE)
first_author<-gsub("\\*","",first_author)
first_author<-gsub("†","",first_author)
first_author<-gsub("‡","",first_author)
first_author<-gsub("§","",first_author)
first_author<-gsub("#","",first_author)
first_author<-gsub("║","",first_author)
first_author<-gsub("¶","",first_author)
first_author<-gsub(",","",first_author)
first_author<-gsub("1","",first_author)
first_author<-gsub("2","",first_author)
first_author<-gsub("3","",first_author)
first_author<-gsub("4","",first_author)
first_author<-gsub("\u00A0", "", first_author)
first_author<-gsub(" ","",first_author)
first_author<-gsub("\n\t"," ",first_author)
if(all.equal(nchar(subject),integer(0)) != TRUE){
JAS_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
JAS_result$first_author[nb]<-first_author[1]
}
}
#JDS=============================================================================
list_JDS <- filter(list, journal == "journal of dairy science") #filtering the journal
#data.frame
JDS_result<-list_JDS
JDS_result<-cbind(JDS_result, subject=NA)
JDS_result<-cbind(JDS_result, first_author=NA)
n<-nrow(list_JDS)
for(i in 0:(n-1)){
nb=i+1
url <- list_JDS$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(".title-text") %>% html_text()
#first_author
first_author<-html %>% html_node(".author-group") %>% html_children() %>% html_text()
first_author <- first_author[-1]
first_author<-gsub(" and ","",first_author)
first_author<-gsub("*","",first_author, fixed=TRUE)
first_author<-gsub("\\*","",first_author)
first_author<-gsub("†","",first_author)
first_author<-gsub("‡","",first_author)
first_author<-gsub("§","",first_author)
first_author<-gsub("#","",first_author)
first_author<-gsub("║","",first_author)
first_author<-gsub("¶","",first_author)
first_author<-gsub(",","",first_author)
first_author<-gsub("1","",first_author)
first_author<-gsub("2","",first_author)
first_author<-gsub("3","",first_author)
first_author<-gsub("4","",first_author)
first_author<-gsub("\u00A0", "", first_author)
first_author<-gsub(" ","",first_author)
first_author<-gsub("\n\t"," ",first_author)
#write dataframe
if(all.equal(nchar(subject),integer(0)) != TRUE){
JDS_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
JDS_result$first_author[nb]<-first_author
}
}
#ANIFEED==============================================================================
list_ANIFEED <- filter(list, journal == "animal feed science and technology") #filtering the journal
#data.frame
ANIFEED_result<-list_ANIFEED
ANIFEED_result<-cbind(ANIFEED_result, subject=NA)
ANIFEED_result<-cbind(ANIFEED_result, first_author=NA)
n<-nrow(list_ANIFEED)
for(i in 0:(n-1)){
nb=i+1
url <- list_ANIFEED$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(".title-text") %>% html_text()
#first_author
first_author<-html %>% html_node(".author-group") %>% html_children() %>% html_text()
first_author <- first_author[2]
first_author<-gsub(" and ","",first_author)
first_author<-gsub("*","",first_author, fixed=TRUE)
first_author<-gsub("\\*","",first_author)
first_author<-gsub("†","",first_author)
first_author<-gsub("‡","",first_author)
first_author<-gsub("§","",first_author)
first_author<-gsub("#","",first_author)
first_author<-gsub("║","",first_author)
first_author<-gsub("¶","",first_author)
first_author<-gsub(",","",first_author)
first_author<-gsub("1","",first_author)
first_author<-gsub("2","",first_author)
first_author<-gsub("3","",first_author)
first_author<-gsub("4","",first_author)
first_author<-gsub("\u00A0", "", first_author)
first_author<-gsub(" ","",first_author)
first_author<-gsub("\n\t"," ",first_author)
#write dataframe
if(all.equal(nchar(subject),integer(0)) != TRUE){
ANIFEED_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
ANIFEED_result$first_author[nb]<-first_author
}
}
#animal=============================================================================
list_animal <- filter(list, journal == "animal") #filtering the journal
#data.frame
animal_result<-list_animal
animal_result<-cbind(animal_result, subject=NA)
animal_result<-cbind(animal_result, first_author=NA)
n<-nrow(list_animal)
for(i in 0:(n-1)){
nb=i+1
url <- list_animal$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(".article-title") %>% html_text()
subject <- subject[1]
#first_author
first_author <- html %>% html_node(".author") %>% html_children() %>% html_text()
first_author <- first_author[1]
first_author <- gsub(" ","",first_author)
#write dataframe
if(all.equal(nchar(subject),integer(0)) != TRUE){
animal_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
animal_result$first_author[nb]<-first_author
}
}
#livestock_sci========================================================================
list_LS <- filter(list, journal == "livestock science") #filtering the journal
#data.frame
livestock_science_result<-list_LS
livestock_science_result<-cbind(livestock_science_result, subject=NA)
livestock_science_result<-cbind(livestock_science_result, first_author=NA)
n<-nrow(list_LS)
for(i in 0:(n-1)){
nb=i+1
url <- list_LS$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(".title-text") %>% html_text()
#first_author
first_author<-html %>% html_node(".author-group") %>% html_children() %>% html_text()
first_author <- first_author[2]
first_author<-gsub(" and ","",first_author)
first_author<-gsub("*","",first_author, fixed=TRUE)
first_author<-gsub("\\*","",first_author)
first_author<-gsub("†","",first_author)
first_author<-gsub("‡","",first_author)
first_author<-gsub("§","",first_author)
first_author<-gsub("#","",first_author)
first_author<-gsub("║","",first_author)
first_author<-gsub("¶","",first_author)
first_author<-gsub(",","",first_author)
first_author<-gsub("1","",first_author)
first_author<-gsub("2","",first_author)
first_author<-gsub("3","",first_author)
first_author<-gsub("4","",first_author)
first_author<-gsub("\u00A0", " ", first_author)
first_author<-gsub(" ","",first_author)
first_author<-gsub("\n\t"," ",first_author)
#write dataframe
if(all.equal(nchar(subject),integer(0)) != TRUE){
livestock_science_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
livestock_science_result$first_author[nb]<-first_author
}
}
#PS==================================================================================
list_PS <- filter(list, journal == "poultry science") #filtering the journal
#data.frame
poultry_result<-list_PS
poultry_result<-cbind(poultry_result, subject=NA)
poultry_result<-cbind(poultry_result, first_author=NA)
n<-nrow(list_PS)
for(i in 0:(n-1)){
nb=i+1
url <- list_PS$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(xpath="//div[2]/div[1]/div/div/h1") %>% html_text()
subject<-gsub("\r\n"," ",subject)
#first_author
first_author<-html %>% html_nodes(".al-author-name") %>% html_children() %>% html_text()
first_author<-gsub("\r\n"," ",first_author)
first_author<-gsub(" ","",first_author)
first_author <- first_author[1]
#write dataframe
if(all.equal(nchar(subject),integer(0)) != TRUE){
poultry_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
poultry_result$first_author[nb]<-first_author
}
}
#AJAS================================================================================
list_AJAS <- filter(list, journal == "AJAS") #filtering the journal
#data.frame
AJAS_result<-list_AJAS
AJAS_result<-cbind(AJAS_result, subject=NA)
AJAS_result<-cbind(AJAS_result, first_author=NA)
n<-nrow(list_AJAS)
for(i in 0:(n-1)){
nb=i+1
url <- list_AJAS$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(".PubTitle") %>% html_text()
#1st author
first_author<-html %>% html_node(xpath="//div[3]/div/div[7]") %>% html_children() %>% html_text()
first_author <- first_author[1]
first_author <- gsub(" ","",first_author)
if(all.equal(nchar(subject),integer(0)) != TRUE){
AJAS_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
AJAS_result$first_author[nb]<-first_author[1]
}
}
#JASB==============================================================================
list_JASB <- filter(list, journal == "journal of animal science and biotechnology") #filtering the journal
#data.frame
JASB_result<-list_JASB
JASB_result<-cbind(JASB_result, subject=NA)
JASB_result<-cbind(JASB_result, first_author=NA)
n<-nrow(list_JASB)
for(i in 0:(n-1)){
nb=i+1
url <- list_JASB$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(".ArticleTitle") %>% html_text()
#first_author
first_author<-html %>% html_node(".test-contributor-names") %>% html_children() %>% html_text()
first_author <- first_author[1]
first_author<-gsub("\u00A0", " ", first_author)
#write dataframe
if(all.equal(nchar(subject),integer(0)) != TRUE){
JASB_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
JASB_result$first_author[nb]<-first_author
}
}
#RBDZ=========================================================================================
list_RBDZ <- filter(list, journal == "revista brasileira de zootecnia") #filtering the journal
#data.frame
revista_brasileira_result<-list_RBDZ
revista_brasileira_result<-cbind(revista_brasileira_result, subject=NA)
revista_brasileira_result<-cbind(revista_brasileira_result, first_author=NA)
n<-nrow(list_RBDZ)
for(i in 0:(n-1)){
nb=i+1
url <- list_RBDZ$URL[nb]
html <- read_html(url, encoding="UTF-8")
#Subject
subject<-html %>% html_nodes(".title") %>% html_text()
#first_author
first_author<-html %>% html_node(".autores") %>% html_children() %>% html_text()
first_author <- first_author[1]
first_author<-gsub("*","",first_author, fixed=TRUE)
first_author<-gsub(" and ","",first_author)
first_author<-gsub("1","",first_author)
first_author<-gsub("2","",first_author)
first_author<-gsub("3","",first_author)
first_author<-gsub("4","",first_author)
first_author<-gsub("\u00A0", "", first_author)
first_author<-gsub("\n","",first_author)
first_author<-gsub("\t","",first_author)
#write dataframe
if(all.equal(nchar(subject),integer(0)) != TRUE){
revista_brasileira_result$subject[nb] <- subject
}
if(all.equal(nchar(first_author),integer(0)) != TRUE){
revista_brasileira_result$first_author[nb]<-first_author
}
}
#bind======================================================================================================
journal_result <- bind_rows(JAS_result,JDS_result,AJAS_result,animal_result,poultry_result,JDR_result,JASB_result,revista_brasileira_result,ANIFEED_result)
#bind======================================================================================================
journal_result <- bind_rows(JAS_result,JDS_result,AJAS_result,animal_result,poultry_result,JASB_result,revista_brasileira_result,ANIFEED_result)
View(journal_result)
write.csv(journal_result,"journal_result_2017_12.txt",row.names=FALSE)
View(livestock_science_result)
#bind======================================================================================================
journal_result <- bind_rows(JAS_result,JDS_result,AJAS_result,livestock_science_result,animal_result,poultry_result,JASB_result,revista_brasileira_result,ANIFEED_result)
write.csv(journal_result,"journal_result_2017_12.txt",row.names=FALSE)
